apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'signing'
apply plugin: 'maven'

repositories {
  mavenCentral()
}

dependencies {
  compile 'com.squareup.okhttp:okhttp:2.4.0'
  compile 'com.google.code.gson:gson:2.3'
  compile 'com.auth0:java-jwt:2.0.1'
}

task javadocJar(type: Jar, dependsOn: javadoc) {
    classifier = 'javadoc'
    from 'build/docs/javadoc'
}

task sourcesJar(type: Jar) {
    from sourceSets.main.allSource
    classifier = 'sources'
}

task fatJar(type: Jar) {
    baseName = project.name + '-all'
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar
}

artifacts {
  archives jar, javadocJar, sourcesJar
}

signing {
  sign configurations.archives
}

allprojects { ext."signing.keyId" = 'my_key' }
allprojects { ext."signing.secretKeyRingFile" = '/home/username/.gnupg/secring.gpg' }
allprojects { ext."signing.password" = 'password' }


mavenPomDir = "build/libs"

uploadArchives {
  repositories {
    mavenDeployer {
      repository(url: "https://oss.sonatype.org/service/local/staging/deploy/maven2/") {
        authentication(userName: 'username', password: 'password')
      }
      pom.version = '1.0.0'
      pom.groupId = 'com.playlyfe'
      pom.artifactId = 'playlyfe-java-sdk'
      pom.project {
        name 'Playlyfe Java and Android SDK'
        description 'This is the official OAuth 2.0 Java and Android client SDK for the Playlyfe API. It supports the client_credentials and authorization code OAuth 2.0 flows.'
        url 'https://github.com/playlyfe/playlyfe-java-sdk'
        inceptionYear '2014'

        scm {
          url 'https://github.com/playlyfe/playlyfe-java-sdk'
          connection 'scm:git@github.com:playlyfe/playlyfe-java-sdk.git'
          developerConnection 'scm:git@github.com:playlyfe/playlyfe-java-sdk.git'
        }
        licenses {
          license {
              name 'The MIT License (MIT)'
              url 'https://github.com/playlyfe/playlyfe-java-sdk/blob/master/LICENSE.md'
              distribution 'repo'

          }
        }

        developers {
          developer {
              id 'playlyfe'
              name 'Peter John'
              email 'peter@playlyfe.com'
          }
        }
      }
      beforeDeployment { MavenDeployment deployment -> signing.signPom(deployment) }
    }
  }
}
